307
РАЗРАБОТКА СИСТЕМЫ МОДЕЛИРОВАНИЯ AD HOC СЕТЕЙ В НЕВЫПУКЛЫХ ОБЛАСТЯХ 
5 Состав программ и основные алгоритмы . 
5.1 Программа для моделирования ad-hoc сетей 
5.1.2 Установка соединений между узлами сети . 
----------
Одной из главных целей работы является поиск и установка соединения между узлами. Соединение устанавливается, если расстояние между двумя узлами меньше радиуса узла r. Наличие соединения означает возможность обмена информацией между этими узлами. Все множество соединенных узлов будет образовывать граф.
Таким образом, необходимо проверить все пары вершин графа на возможное наличие связи между ними.
Задача поиска разделяется на 2 случая:
1.  Граф имеет препятствие в виде сферы.
2.  Препятствие отсутствует.
В первом случае узлы графа уже сгенерированы так, чтобы их координаты лежали за пределами радиуса препятствия. Препятствие может занимать 0%, 10%, 20% и 50% это объема общей сферы.
Также для первого случая необходимо иметь процедуру для вычисления расстояние от точки (центра препятствия) до прямой (вектора между двумя узлами).
Величина векторного произведения двух 3-мерных векторов равна площади параллелограмма, построенного на них. Однако эта площадь также равна произведению основания на высоту параллелограмма, а длина высоты - искомая 	дистанция 	d 	(P, 	L).
Представим, что точка  и точка  – центры узлов. Точка P – центр препятствия. Нахождение расстояние между точкой и прямой по формуле(4):
Рисунок 5 - Параллелограмм
Сам алгоритм установления соединений между узлами сети заключается в следующем:
1.  Перебираются все пары вершин графа.
2.  Если расстояние между двумя узлами (node1 и node2), рассматриваемыми на текущей итерации, меньше r, то выполняется переход к следующему шагу алгоритма.
3.  Если между узлами node1 и node2 еще нет соединения, то есть в списке ребер node1 нет пути к узлу node2, то переходим к следующему шагу.
Дальнейшие действия алгоритма зависят от того, есть ли в графе препятствие.
4.  Если препятствие есть, то необходимо проверить, мешает ли оно установлению соединения между узлами. Если да, выполнение алгоритма продолжается с другой парой узлов. Если нет, то устанавливается соединение между узлами, рассматриваемыми в данный момент.
Если же препятствия нет и предыдущие пункты алгоритма истинны, то соединение устанавливается.
В список ребер node1 добавляется узел node2 и, соответственно, в список node2 добавляется узел node1.