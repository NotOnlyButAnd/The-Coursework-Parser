186
ОПТИМИЗАЦИЯ ИСПОЛЬЗОВАНИЯ МОБИЛЬНОГО ТРАФИКА В ОС ANDROID
3 Разработка программы 
3.2 Реализация кэширования 
----------
Кэширование файлов в классе MediaPlayer было реализовано с помощью библиотеки «AndroidVideoCache» [4]. Библиотека была предусмотрена для видео файлов, но мною была переделана для аудио файлов.
На рисунке 3 показана схема воспроизведения с алгоритмом кэширования.
Рисунок 3 – схема воспроизведения с алгоритмом кэширования
Из состояния бездействия программа переходит в состояние инициализации, где в первую очередь проверяется наличие кэш-файла текущей аудиозаписи и, если его нет, то устанавливается связь с сервером и памятью устройства для дальнейшего кэширования. Если же такой файл имеется, то воспроизведение идет с устройства без использования интернета, следовательно, соединение с сервером не устанавливается. Далее в состоянии подготовки программа загружает аудиозапись в оперативную память для дальнейшего воспроизведения и сохранения (если идет on-line воспроизведение). Когда часть файла уже загружена, программа переходит в состояние готовности, а из него воспроизведения и начинает проигрывать аудиозапись, продолжая подгружать файл из интернета или внутреннего хранилища устройства. Из состояния воспроизведения по желанию пользователя программа может перейти в состояние паузы, где воспроизведение будет приостановлено, и обратно. При завершении воспроизведения программа переходит в состояние «Стоп», а затем «Конец», освобождая оперативную память и сохраняя файл кэша на устройстве.
Код программы с реализацией алгоритма кэширования находится в приложении Б.