358
ПЕРСОНАЛЬНЫЙ АССИСТЕНТ С ГОЛОСОВЫМ УПРАВЛЕНИЕМ НА ОСНОВЕ МОБИЛЬНОГО УСТРОЙСТВА 
3. ЧАСТЬ РЕАЛИЗАЦИИ 
3.1. Реализация xml-разметки 
3.1.3. Функция onActivityResult() 
----------
Эта самая основная функция данной программы, тут мы получаем результаты распознавания и распределяем их по соответствующим функциям в зависимости от полученной команды:
* if (resultCode == RESULT_OK && null != data) – проверяем, что получили не пустые данные;
* ArrayList <String> result = data.getStringArrayListExtra(RecognizerIntent.EXTRA_RESULTS); text = result.get(0) – записываем результаты в список, после чего получаем последний распознанный текст.
* if (!b_number && !b_sms && !b_text && !b_calend &&
!b_calend_text) txtSpeechInput.setText("Команда '" + text + "' неверна. Попробуйте еще раз."); else txtSpeechInput.setText(text) – проверяем, является ли распознанное слово какой-либо командой, если таковой не является, то выводит ошибку, как на рисунке 8, иначе выводит нашу команду и выполняет
дальнейшие действия в зависимости от команды;
Рисунок 8 – пример ввода неверной команды
* если получена одна из команд «написать сообщение» или «отправить сообщение», программа отмечает b_sms = true и заново запускает распознавание;
* если b_sms = true мы сохраняем имя получателя и отмечаем b_text = true, после чего снова идет распознавание;
* если b_sms = true и b_text = true проверяем, правильно ли продиктован номер, если да, пробуем найти такого абонента в телефонной книге, если такового нет, то отправка происходит просто по номеру, который был продиктован ранее, после чего снова помечаем b_sms = false и b_text = false;
Рисунок 9 – поэтапный пример работы отправки sms-сообщения
* если получена одна из команд «позвонить абоненту» или «набрать абонента», программа отмечает b_number = true и заново запускает распознавание;
* если b_number = true пробуем найти такого абонента в телефонной книге, если такового нет, то происходит просто вызов по номеру, который был продиктован ранее, после чего снова помечаем b_number = false;
Рисунок 10 – поэтапный пример работы набора номера
* если получена одна из команд «поставить напоминание» или «оставить заметку», программа отмечает b_calend = true и заново запускает распознавание;
* если b_calend = true мы сохраняем сообщение для календаря и отмечаем b_calend_text = true, после чего снова идет распознавание;
* если b_calend = true и b_calend_text = true, мы разделяем дату на день, месяц и год, и вызываем функцию добавления события в календарь, после чего снова помечаем b_calend = false и b_calend_text = false;
Рисунок 11 – поэтапный пример работы составления заметки в календаре