328
ANDROID-ПРИЛОЖЕНИЕ ДЛЯ ВОСПРОИЗВЕДЕНИЯ ЗВУКА
3 Разработка программы . 
3.1 Работа с MediaPlayer . . 
----------
Класс MediaPlayer [1] работает на основе состояний, которые управляются с помощью внутреннего конечного автомата – машины состояний. На рисунке 1 показано изменение состояния объекта MediaPlayer для элемента управления воспроизведением. Одиночная стрелка означает синхронные вызовы метода, а пунктирная - асинхронные и обратные вызовы.
Рис.1 Жизненный цикл объекта MediaPlayer
1* - Looping == true && воспроизведение завершается
2* - Looping == false && Completion() вызывается для OnCompletionListener.
Жизненный цикл объекта MediaPlayer содержит несколько состояний. При создании нового объекта или вызове метода reset() MediaPlayer переходит в состояние бездействия, в котором воспроизведение невозможно.
Чтобы начать воспроизведение нужно пройти инициализацию, а для этого необходимо указать допустимый источник мультимедиа, вызвав метод  setDataSourse().
Затем приложение вызывает метод prepare() или prepareAsync() для перехода в состояние готовности. Оба этих метода отвечают за получение данных, их буферизацию и декодирование файла, но метод prepare() значительно уступает методу prepareAsync() в скорости, из-за чего лучше использовать метод prepareAsync(), который выполняется в фоновом режиме и возвращается сразу же после завершения, отправляя обратный вызов OnPreparedListener.onPrepared() и приводит объект в состояние готовности.
После прохождения инициализации и проверки на готовность можно начинать воспроизведение и управлять им с помощью команд start() (начало воспроизведения) и seekTo() (перемотать воспроизведение на N миллисекунд вперед или назад).
После начала воспроизведения объект переходит в состояние «запущен». При желании можно поставить на паузу воспроизведение, вызвав метод pause(), после чего объект MediaPlayer перейдет в состояние «пауза», из которого можно выбраться, снова вызвав метод start(), что возобновит воспроизведение и переведет объект в состояние «запущен» или вызвать метод stop(), перейдя в состояние «остановлен». Также в состоянии паузы можно вызывать метод seekTo() для перемотки.
В случае завершения воспроизведения файла, можно возобновить воспроизведение, вызвав метод start() (в этом случае состояние изменится на «запущен») или же объект перейдет в состояние «остановлен», а затем в состояние «конец», с помощью метода release().
Обработчик OnErrorListener, метод обратного вызова OnErrorListener.onError() будет вызван при любых ошибках, чтобы можно было их обрабатывать надлежащим образом.
Класс MediaPlayer поддерживает воспроизведение медиафайлов форматов: WAV, AAC, MP3, WMA, AMR, OGG, MIDI. Чаще всего для аудиозаписей используется формат MP3.