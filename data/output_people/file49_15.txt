1098
РАЗРАБОТКА МОБИЛЬНОГО ПРИЛОЖЕНИЯ МНОГОЗВЕННОЙ АРХИТЕКТУРЫ НА БАЗЕ ОПЕРАЦИОННОЙ СИСТЕМЫ ANDROID 
3 Мобильное приложение для ОС Android 
3.2 Активности приложения 
3.2.3 Главный экран уровня развития 
----------
Активность экрана уровня развития представляет собой основную информацию о текущем прогрессе авторизированного пользователя на выбранном уровне развития.  На активность экрана уровня развития пользователь переходит из активности выбора уровня развития. Содержание активности зависит от того, какой именно уровень развития выбрал пользователь.
Активность описана в файле LevelActivity.java. Включает в себя фото профиля  пользователя (ImageView), имя и статус пользователя (TextView), блок текущего задания, блок доступных в данных момент для выполнения заданий. Снизу экрана активности располагается шкала текущего прогресса пользователя на выбранном уровне развития (ProgressBar). Макет активности главного экрана уровня развития описан в файле activity_level.xml. Внешний вид активности главного экрана уровня развития на примере материального уровня изображен на рисунке 13.
Рисунок 13 – Активность главного экрана уровня развития на примере материального уровня развития
Фото пользователя устанавливается им по желанию. Изначально для каждого пользователя фото отсутствует. При нажатии на стандартную иконку фото пользователю предлагается диалоговое окно, представляющее собой выбор одного из трех действий: открыть фото, сменить фото (галерея), сменить фото (камера).
При нажатии на действие «открыть фото» фото разворачивается на весь экран для его детального рассмотрения.
При нажатии на действие «сменить фото (галерея)» производится переход на вспомогательную активность, которая осуществляет переход в галерею фотографий на устройстве пользователя для выбора одной фотографии и установки ее в качестве фото своего профиля. Реализация перехода на активность выбора фото из галереи фотографий выглядит следующим образом:
intent = new Intent (Intent.ACTION_PICK,
android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI); startActivityForResult(intent, PICK_IMAGE_REQUEST);
Как только фото было выбрано, происходит переход на дополнительную активность загрузки изображения на сервер, описанную в файле ImageUploadActivity.java. Данная активность состоит из предварительного просмотра загружаемого фото, которое помещается в ImageView, и кнопки «загрузить» для подтверждения и отправки фото на сервер (рисунок 14). При нажатии на кнопку «загрузить» загружаемое изображение кодируется с помощью Java функции Base64.encodeToString() и посылается на сервер в виде зашифрованной строки. Обработка изображения в виде зашифрованной строки на сервере описана в файле серверной части image_upload.php.
Сначала строка декодируется с помощью PHP функции base64_decode($image), а затем изображение с уникальным названием, которое имеет вид user_+ <имя пользователя> + .jpg, помещается в папку на сервере, где хранятся все фотографии пользователей, загрузившись фото своего профиля. По завершению загрузки сервер посылает клиенту ответ об успешной загрузке, после чего активность загрузки изображений завершает свою работу. Загруженное фото в виде зашифрованной строки помещается в
Рисунок 14 – Активность загрузки изображения на сервер
локальную базу данных SQLite. Это необходимо для того, чтобы при повторном переходе на активность уровня развития не происходило дополнительного обращения к серверу базы данных и фото профиля пользователя не загружалось повторно. В итоге управление снова переходит на активность главного экрана уровня развития.
При нажатии на действие «сменить фото (камера)» производится переход на вспомогательную активность, которая запускает стандартное приложение камеры на устройстве пользователя, чтобы сделать фото.
Реализация перехода на данную активность выглядит следующим образом:
intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE); photoUri = Uri.fromFile(getOutputMediaFile()); intent.putExtra(MediaStore.EXTRA_OUTPUT, photoUri); startActivityForResult(intent, PHOTO_IMAGE_REQUEST); После того, как пользователь сделает фото, оно, как и в случае с выбором фото из галереи, переносится и отображается на вспомогательной активности, описанной в файле ImageUploadActivity.java и предлагается загрузить сделанное фото на сервер. По завершению загрузки фото также в виде зашифрованной строки помещается в локальную базу данных SQLite, и управление переходит активности главного экрана уровня развития.
Рядом с фото профиля пользователя находятся два компонента TextView. В первом представлено имя авторизированного пользователя в виде связки имени и фамилии, а во втором компоненте находится его текущий статус, который пользователь может изменить в настройках своего профиля, переход в которые осуществляется из контекстного меню в правом верхнем углу экрана текущей активности.
Под фото профиля пользователя располагается блок текущего задания, который несет в себе информацию о задании, которое пользователь выбрал для выполнения. Информация состоит из названия текущего задания, количества рекомендуемого опыта, присуждаемого пользователю по завершению текущего задания. Под описанием задания располагаются 2 кнопки: «о задании» для перехода на активность, содержащую полную информацию по заданию, и «написать куратору» для перехода на активность личного чата с куратором.
Под блоком текущего задания пользователя располагается блок доступных для выполнения пользователем заданий, исходя из его текущего прогресса на выбранном уровне развития. Для пользователя отображается три случайно выбранных задания из списка доступных ему заданий, хранящихся в базе данных. Каждое доступное задание содержит в себе его название и рекомендуемое количество опыта, присуждаемое пользователю в ходе завершения выполнения задания. При нажатии на доступное задание происходит переход на активность полной информации о нем. Пользователь в любой момент может обновить список доступных ему заданий, если его не устраивает текущий список. Новые доступные задания также подгружаются из базы данных, учитывая текущий уровень прогресса пользователя на выбранном уровне развития. Задания, которые пользователь уже выполнил или выполняет в текущий момент, не загружаются. Во время загрузки отображается полоса загрузки для визуального отображения посланного запроса на сервер и ожидания с ответа с сервера. Также напротив каждого доступного для выполнения задания имеется кнопка «начать», по нажатию которой пользователь опрашивается, уверен ли он, что хочет начать выполнять данное задание. Если пользователь соглашается и в данный момент он выполняет одно из заданий и хочет его заменить, то по согласию пользователя у него отнимается количество опыта, равное половине рекомендуемого количества опыта в заменяемом текущем задании. Выполняется запрос на сервер, подразумевающий начало задания пользователем. Обработка данного запроса описана в файле серверной части start_task.php. Если запрос выполнен успешно, то выбранное пользователем
задание становится текущим для выполнения.
Блок доступных заданий по умолчанию находится в свернутом состоянии, если пользователь в данный момент выполняет одно из заданий. Если же пользователь не выполняет ни одно из заданий в данный момент, блок доступных для выполнения заданий находится по умолчанию в развернутом состоянии.
Блоки текущего задания и доступных для выполнения заданий объединены в один общий прокручиваемый вниз или вверх блок. Данных ход является полезным в том случае, когда информация, содержащаяся в блоке текущего задания или блоке доступных заданий, не помещается на экране активности и выходит за ее пределы.
Шкала текущего прогресса пользователя на выбранном уровне привязана к нижней части активности. Шкала предоставляет информацию о текущем уровне прогресса пользователя, текущем количестве опыта и максимальном количестве опыта, которое может получить пользователь на текущем уровне прогресса. Шкала меняет свое значение каждый раз, когда пользователь завершает задание и куратор выносит решение о количестве начисляемых пользователю очков опыта. Как только шкала достигнет максимального на данном уровне прогресса значения, пользователь получает новый уровень прогресса, где максимальный уровень прогресса будет выше, чем на предыдущем уровне прогресса.
Также на активности главного экрана уровня развития присутствует контекстное меню, которое находится в правом верхнем углу экрана активности. Контекстное меню включает в себя три ссылки:
а)   Таблица рекордов (при выборе осуществляет переход на активность таблицы рекордов, где пользователь может узнать текущий прогресс развития всех пользователей на данном уровне развития);
б) Настройки (при выборе осуществляет переход на активность
настроек, где пользователь может изменить информацию о себе);
в)  Выйти (при выборе осуществляет выход из профиля и переход на активность авторизации, при следующем запуске приложения будет запускаться активность авторизации).