526
РАЗРАБОТКА МОБИЛЬНОГО ПРИЛОЖЕНИЯ МНОГОЗВЕННОЙ АРХИТЕКТУРЫ НА БАЗЕ ОПЕРАЦИОННОЙ СИСТЕМЫ ANDROID
3 Мобильное приложение для ОС Android 
3.2 Активности приложения 
3.2.1 Вход/регистрация 
----------
Для того чтобы начать использовать приложение, пользователю необходимо авторизоваться, либо зарегистрироваться, если пользователь ещё не создавал учетную запись в разработанном приложении. Активность входа является стартовой активностью, если пользователь не был авторизован ранее. Также переход на активность входа осуществляется, когда пользователь выходит из своего профиля из контекстного меню активности главного экрана уровня развития. Внешний вид активности входа в учетную запись пользователя изображен на рисунке 10.
Рисунок 10 – Активность входа в учетную запись пользователя
Активность входа пользователя описана в файле LoginActivity.java и является стартовой активностью, которую видит пользователь при первом запуске приложения. На экране данной активности имеется 2 поля для ввода (EditText), кнопка для входа (Button) и две ссылки для перехода на активность регистрации и запроса пользователя на восстановление пароля.
Макет активности входа описан в файле activity_login.xml.
В случае запроса на восстановление пароля пользователю во всплывающем диалоговом окне предлагается ввести электронный почтовый ящик, который указывался при регистрации. На этот почтовый ящик ему будет отправлено письмо с новым случайно сгенерированным паролем. Поля для ввода в активности входа предлагают пользователю ввести его логин, который он указывал при регистрации и пароль. Как только пользователь нажимает кнопку «войти», форма авторизации скрывается и на ее место помещается полоса загрузки авторизации. На сервер базы данных отправляется запрос на вход пользователя, обработка которого описана в файле серверной части login.php. Здесь проверяется соответствие введенного логина и пароля с содержащимися логинами и паролями в базе данных. Если проверка прошла успешно, то приложение продолжает свою работу, осуществив переход на активность выбора уровня развития.
Активность 	регистрации 	пользователя 	описана 	в 	файле
RegisterActivity.java. На экране данной активности имеется 6 полей для ввода текста (EditText), метка, указывающая на обязательные поля для ввода (TextView) и кнопка регистрации (Button). Макет активности регистрации описан в файле activity_register.xml. Внешний вид активности регистрации учетной записи пользователя изображен на рисунке 11.
Рисунок  11– Активность регистрации учетной записи пользователя Процедура регистрации предполагает собой ввод пользователем уникального логина для авторизации в приложении (от 4 до 20 символов латинского алфавита без пробелов), электронного почтового ящика пользователя, пароля (от 4 до 20 символов латинского алфавита без пробелов) и имени пользователя для обращения к нему. Имя пользователя состоит из его фамилии, имени и отчества. Все поля при регистрации являются обязательными, за исключением полного имени пользователя, его можно указать при желании.
Как только пользователь нажимает кнопку «регистрация», форма регистрации скрывается и на ее место помещается полоса загрузки регистрации. На сервер базы данных отправляется запрос на регистрацию пользователя, обработка которого описана в файле серверной части registration.php. Логин и почта каждого пользователя должны быть уникальными, поэтому перед тем, как одобрить процедуру регистрации, проверяется отсутствие введенного логина и почтового ящика в базе данных. Если введенный логин или почта уже существует в базе данных, то пользователю возвращается сообщение о соответствующей ошибке во всплывающем сообщении. Если же такого логина и почты нет в базе данных, введенные пользователей данные заносятся в базу данных, при этом пароль шифруется функцией PHP password_hash()  для его защищенности, и приложение продолжает свою работу, осуществив переход на активность выбора уровня развития.
По завершении процедуры авторизации или регистрации в объект сохраненных настроек prefs класса SharedPreferences заносятся флаг авторизации, id пользователя, имя пользователя и статус доступа к основным четырем уровням развития, который при регистрации пользователя помечается как запрещенный. Далее осуществляется переход на активность выбора уровня развития пользователя.